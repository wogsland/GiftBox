var imageType=/image.*/;function createVideoImage(e,d,b,c){var a=$('<img class="recruiting-token-video" id="'+e+'">');a.attr("src",d);a.data("url",b);a.data("source",c);a.data("saved",false);return a}function openVimeo(d){var b=vimeoId(d);var a=false;if(b){$(".video-dialog-button").addClass("disable-clicks");var c="https://vimeo.com/api/v2/video/"+b+".json";$.ajax({type:"POST",async:false,dataType:"json",url:"/ajax/url-valid",data:{url:c},success:function(e){$.getJSON(c,function(g){var f=createVideoImage(b,g[0].thumbnail_medium,d,"vimeo");createThumbnail(f,"company-video-container")});a=true},error:function(){$("label").css("color","red");$("#video-dialog-url").attr("label","Please choose a valid Vimeo URL.")},complete:function(){$(".video-dialog-button").removeClass("disable-clicks")}})}else{$("label").css("color","red");$("#video-dialog-url").attr("label","Unable to extract a Vimeo video ID from the URL.")}return a}function openYouTube(c){var d=youTubeId(c);if(d){$(".video-dialog-button").addClass("disable-clicks");var b="https://img.youtube.com/vi/"+d+"/0.jpg";var a=false;$.ajax({type:"POST",async:false,dataType:"json",url:"/ajax/url-valid",data:{url:b},success:function(f){if(f.data.httpCode=="200"){var e=createVideoImage(d,b,c,"youtube");createThumbnail(e,"company-video-container");a=true}else{$("label").css("color","red");$("#video-dialog-url").attr("label","Please choose a valid Youtube URL.")}},complete:function(){$(".video-dialog-button").removeClass("disable-clicks")}});return a}else{$("label").css("color","red");$("#video-dialog-url").attr("label","Unable to extract a Youtube video ID from the URL.");return false}}function processVideoURL(){var a=$("#video-dialog-url").val();var d=false;var c=isYouTube(a);var b=isVimeo(a);if(c){d=openYouTube(a)}else{if(b){d=openVimeo(a)}}if(d){$("#video-dialog")[0].close();$("label").css("color","");$("#video-dialog-url").attr("label","Please choose a Youtube or Vimeo video.")}else{if(!c&&!b){$("label").css("color","red");$("#video-dialog-url").attr("label","Please choose a Youtube or Vimeo video.")}}}function cancelVideoURL(){$("label").css("color","")}function openVideoDialog(){$("#video-dialog-url").val(null);$("#video-dialog")[0].open()}function getDeleted(a){return $("#company-"+a+"-container").data("deleted")}function addDeleted(c,d){var b=$("#company-"+c+"-container");var a=b.data("deleted");a.push(d)}function removeDeleted(b,d){var a=getDeleted(b);var c=a.indexOf(d);a.splice(c,1)}function removeImage(a){var b=a.data("saved");if(b===true){var c=a.data("id");if(a.hasClass("recruiting-token-image")){addDeleted("image",c)}else{if(a.hasClass("recruiting-token-video")){addDeleted("video",c)}}}a.parent().parent().remove()}function removeImageById(a){removeImage($("#"+a))}function createThumbnail(c,e){$("#"+e).removeAttr("hidden");var a=$("<div>");var b=$("<div>");var d=$('<paper-button raised class="remove-button">REMOVE</paper-button>').click(function(){removeImage(c)});b.addClass("inner-thumbnail-container");c.addClass("photo-thumbnail");a.addClass("thumbnail-container");a.attr("id","thumbnail-container-"+($(".thumbnail-container").size()+1));b.append(c);b.append(d);a.append(b);$("#"+e).append(a)}function handleImageFileSelect(a){$("#save-continue-button").addClass("disable-clicks");for(var d=0;d<a.target.files.length;d++){var c=a.target.files[d];if(!c.type.match(imageType)){alert(c.name+" is not an image file (.jpg, .png, etc.).");continue}var b=$('<img class="recruiting-token-image" id="'+c.name.replace(".","_")+'">');b.attr("src",window.URL.createObjectURL(c));b.data("file",c);b.data("saved",false);createThumbnail(b,"company-image-container")}$("#save-continue-button").removeClass("disable-clicks");$("#select-image-file:file").val("")}function uploadFileData(b,d,a){var c=new XMLHttpRequest();if(c.upload){c.upload.onprogress=function(f){if(f.lengthComputable){}};c.open("POST","/upload",false);c.setRequestHeader("X-FILENAME",d);c.send(b);saveTokenImage(a,d)}}function uploadFile(c,d,b){d=typeof d!=="undefined"?d:c.name;var a=new FileReader();a.fileName=d;a.onloadend=function(){uploadFileData(a.result,a.fileName,b)};a.readAsDataURL(c)}function deleteChildren(b){var a=getDeleted(b);a.forEach(function(e){var c="/ajax/recruiting_company_"+b+"/delete/";var d={id:e};$.post(c,d,function(f,g){if(f.status==="SUCCESS"){removeDeleted(b,e)}else{if(f.status==="ERROR"){alert("Recruiting token "+b+" delete failed: "+f.message)}else{alert("Recruiting token "+b+" delete failed: "+g)}}},"json").fail(function(){alert("Recruiting token "+b+" delete failed.")})})}function postSave(a,b,c){$.ajax({type:"POST",datatype:"json",async:false,url:b,data:c,success:function(d,e){if(d.status==="SUCCESS"){a.data("id",d.id);a.data("saved",true)}else{if(d.status==="ERROR"){alert("Save failed: "+d.message)}else{alert("Save failed: "+e)}}}}).fail(function(){alert("Save failed.")})}function saveTokenImage(a,d){a.data("file").name=d;var b="/ajax/recruiting_company_image/save/";var c={recruiting_company_id:a.data("recruiting_company_id"),file_name:d};postSave(a,b,c)}function saveTokenVideo(a){var b="/ajax/recruiting_company_video/save/";var c={recruiting_company_id:a.data("recruiting_company_id"),url:a.data("url"),source:a.data("source"),source_id:a.attr("id")};postSave(a,b,c)}function isValid(e){var a=false;var c=$("#"+e);var b=c[0].value;if(typeof b=="undefined"||!b){var d=c[0].label;$("#validation-message").html(d+" is a required field.");$("#validation-dialog")[0].open()}else{a=true}return a}function linkifyText(){$("#job-title")[0].updateValueAndPreserveCaret(excludedLinkify($("#job-title").val()));$("#job-description")[0].updateValueAndPreserveCaret(excludedLinkify($("#job-description").val()));$("#skills-required")[0].updateValueAndPreserveCaret(excludedLinkify($("#skills-required").val()));$("#responsibilities")[0].updateValueAndPreserveCaret(excludedLinkify($("#responsibilities").val()));$("#perks")[0].updateValueAndPreserveCaret(excludedLinkify($("#perks").val()));if($("#company").length){linkifyCompanyText()}}function linkifyCompanyText(){$("#company-description")[0].updateValueAndPreserveCaret(excludedLinkify($("#company-description").val()));$("#company-values")[0].updateValueAndPreserveCaret(excludedLinkify($("#company-values").val()))}function excludedLinkify(b){var a=[{url:"asp.net",temp:"84gt43qg8ci4bci4"},{url:"ASP.NET",temp:"87c84c8n3cgnn7c4"},{url:"avc.net",temp:"v5y5s4v5by5b55vb"},{url:"AVC.NET",temp:"b7j7fjn6n7n7b6b6"},{url:"apc.net",temp:"m87t8r6kbjv6j65b"},{url:"APC.NET",temp:"23b46un6unndubyb"},{url:"Salesforce.com",temp:"i3cc5si75cm5cik7c5"},{url:"salesforce.com",temp:"29jftwkgpgmetfueeg"},{url:"Force.com",temp:"chuiueri7n34ininwcf"},{url:"force.com",temp:"lncgw82jfnwuchfu3"}];a.forEach(function(c){b=b.replace(c.url,c.temp)});b=Autolinker.link(b);a.forEach(function(c){b=b.replace(c.temp,c.url)});return b}function saveRecruitingToken(c){var d=null;var b=null;var a=null;if($("#recruiting-token-form")[0].validate()){linkifyText();a=document.getElementById("recruiting-token-form").serialize();if("true"==$("#recruiter-profile").attr("aria-checked")){a.recruiter_profile="Y"}else{a.recruiter_profile="N"}$("#save-continue-button").addClass("disable-clicks");$.ajax({type:"POST",url:"/ajax/recruiting_token/save/",data:a,dataType:"json",async:false,success:function(g,i){if(g.status==="SUCCESS"){$("#id").val(g.id);$("#long-id").val(g.long_id);var f=g.user_id;var h=g.id;var e=g.recruiting_company_id;if(!$("#recruiting-company-id").length){companyInput='<input type="hidden" id="recruiting-company-id" name="recruiting_company_id" value="'+e+'">';$("#recruiting-token-form").prepend(companyInput)}closeStatus();if(c){$("#token-preview").attr("href","/token/recruiting/"+g.long_id);$("#token-preview")[0].click()}window.location="/create_company?id="+e+"&referrer="+g.long_id}else{if(g.status==="ERROR"){$("#validation-message").html(g.message);$("#validation-dialog")[0].open()}else{alert(i)}}$("#save-button").html("Save")}}).fail(function(){alert("Save failed")}).always(function(){$("#save-continue-button").removeClass("disable-clicks")})}}function saveCompany(){var b=null;var a=null;if($("#recruiting-company-form")[0].validate()){linkifyCompanyText();setStatus("Saving company...");a=document.getElementById("recruiting-company-form").serialize();$("#save-continue-button").addClass("disable-clicks");$.ajax({type:"POST",async:false,datatype:"json",url:"/ajax/recruiting_company/save/",data:a,success:function(e,f){if(e.status==="SUCCESS"){$("#id").val(e.id);var d=e.user_id;var c=e.id;if(c&&d){if($("#company-images").length){$(".recruiting-token-image").each(function(){var g=$(this);g.data("recruiting_company_id",c);if(!g.data("saved")){var h=g.data("file");var i=d+"_"+c+"_"+Date.now()+"_"+h.name;g.data("file_name",i);uploadFile(h,i,g)}});deleteChildren("image")}if($("#company-videos").length){$(".recruiting-token-video").each(function(){var g=$(this);g.data("recruiting_company_id",c);if(!g.data("saved")){saveTokenVideo(g)}});deleteChildren("video")}}closeStatus();setTimeout(function(){window.location="/send_recruiting?referrer="+c+"&id="+$("#recruiting-token-id").val()},1000)}else{if(e.status==="ERROR"){alert(e.message)}else{alert(f)}}$("#save-button").html("Save")}}).fail(function(){alert("Save failed")}).always(function(){$("#save-continue-button").removeClass("disable-clicks")})}}function openToken(){var b=$("#token-to-open");var a=$("#token-to-open")[0].contentElement;a.selected=null;$("#open-dialog")[0].open()}function processOpen(){if($("#open-token-form")[0].validate()){setStatus("Opening token...");var b=$("#token-to-open")[0].contentElement;var a=b.selectedItem.id;$("#open-dialog")[0].close();window.location="/create_recruiting?id="+a}}function chooseCompany(){var b=$("#company-to-use");var a=$("#company-to-use")[0].contentElement;a.selected=null;$("#use-existing-company-dialog")[0].open()}function setStatus(a){$("#status-message").html(a);$("#status-dialog").css("height","170px");$("#status-dialog")[0].open()}function closeStatus(){$("#status-dialog").css("height","0px");$("#status-dialog")[0].close()}function shrink(a){a.animate({height:"toggle"},1000,function(){})}function fadeIn(a){a.animate({opacity:1},1000,function(){})}function finish(){shrink($("#company-social-media"));shrink($("#company-videos"));shrink($("#company-images"));shrink($("#company-info"));shrink($("#basic-info"));shrink($("#required-info"));$(".bottom-button").each(function(){shrink($(this))});fadeIn($("#send-token-via"))}function backToToken(a){window.location="/create_recruiting?id="+a};