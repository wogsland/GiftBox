var imageType=/image.*/;function createVideoImage(e,d,b,c){var a=$('<img class="recruiting-token-video" id="'+e+'">');a.attr("src",d);a.data("url",b);a.data("source",c);a.data("saved",false);return a}function openVimeo(d){var b=vimeoId(d);var a=false;if(b){var c="https://vimeo.com/api/v2/video/"+b+".json";$.ajax({type:"POST",dataType:"json",async:false,url:"/ajax/url-valid",data:{url:c},success:function(e){$.getJSON(c,function(g){var f=createVideoImage(b,g[0].thumbnail_medium,d,"vimeo");createThumbnail(f,"company-video-container")});a=true},error:function(){$("label").css("color","red");$("#video-dialog-url").attr("label","Please choose a valid Vimeo URL.")}})}else{$("label").css("color","red");$("#video-dialog-url").attr("label","Unable to extract a Vimeo video ID from the URL.")}return a}function openYouTube(c){var d=youTubeID(c);if(d){var b="https://img.youtube.com/vi/"+d+"/0.jpg";var a=false;$.ajax({type:"POST",dataType:"json",async:false,url:"/ajax/url-valid",data:{url:b},success:function(f){if(f.data.httpCode=="200"){var e=createVideoImage(d,b,c,"youtube");createThumbnail(e,"company-video-container");a=true}else{$("label").css("color","red");$("#video-dialog-url").attr("label","Please choose a valid Youtube URL.")}}});return a}else{$("label").css("color","red");$("#video-dialog-url").attr("label","Unable to extract a Youtube video ID from the URL.");return false}}function processVideoURL(){var a=$("#video-dialog-url").val();var d=false;var c=isYouTube(a);var b=isVimeo(a);if(c){d=openYouTube(a)}else{if(b){d=openVimeo(a)}}if(d){$("#video-dialog")[0].close();$("label").css("color","");$("#video-dialog-url").attr("label","Please choose a Youtube or Vimeo video.")}else{if(!c&&!b){$("label").css("color","red");$("#video-dialog-url").attr("label","Please choose a Youtube or Vimeo video.")}}}function cancelVideoURL(){$("label").css("color","")}function openVideoDialog(){$("#video-dialog-url").val(null);$("#video-dialog")[0].open()}function getDeleted(a){return $("#company-"+a+"-container").data("deleted")}function addDeleted(c,d){var b=$("#company-"+c+"-container");var a=b.data("deleted");a.push(d)}function removeDeleted(b,d){var a=getDeleted(b);var c=a.indexOf(d);a.splice(c,1)}function removeImage(a){var b=a.data("saved");if(b===true){var c=a.data("id");if(a.hasClass("recruiting-token-image")){addDeleted("image",c)}else{if(a.hasClass("recruiting-token-video")){addDeleted("video",c)}}}a.parent().parent().remove()}function removeImageById(a){removeImage($("#"+a))}function createThumbnail(c,e){var a=$("<div>");var b=$("<div>");var d=$('<paper-button raised class="remove-button">REMOVE</paper-button>').click(function(){removeImage(c)});b.addClass("inner-thumbnail-container");c.addClass("photo-thumbnail");a.addClass("thumbnail-container");a.attr("id","thumbnail-container-"+($(".thumbnail-container").size()+1));b.append(c);b.append(d);a.append(b);$("#"+e).append(a)}function handleImageFileSelect(a){for(var d=0;d<a.target.files.length;d++){var c=a.target.files[d];if(!c.type.match(imageType)){alert(c.name+" is not an image file (.jpg, .png, etc.).");continue}var b=$('<img class="recruiting-token-image" id="'+c.name.replace(".","_")+'">');b.attr("src",window.URL.createObjectURL(c));b.data("file",c);b.data("saved",false);createThumbnail(b,"company-image-container")}}function uploadFileData(b,d,a){var c=new XMLHttpRequest();if(c.upload){c.upload.onprogress=function(f){if(f.lengthComputable){}};c.open("POST","/upload",true);c.setRequestHeader("X-FILENAME",d);c.send(b);saveTokenImage(a,d)}}function uploadFile(c,d,b){d=typeof d!=="undefined"?d:c.name;var a=new FileReader();a.fileName=d;a.onloadend=function(){uploadFileData(a.result,a.fileName,b)};a.readAsDataURL(c)}function deleteChildren(b){var a=getDeleted(b);a.forEach(function(e){var c="/ajax/recruiting_token_"+b+"/delete/";var d={id:e};$.post(c,d,function(f,g){if(f.status==="SUCCESS"){removeDeleted(b,e)}else{if(f.status==="ERROR"){alert("Recruiting token "+b+" delete failed: "+f.message)}else{alert("Recruiting token "+b+" delete failed: "+g)}}},"json").fail(function(){alert("Recruiting token "+b+" delete failed.")})})}function postSave(a,b,c){$.post(b,c,function(d,e){if(d.status==="SUCCESS"){a.data("id",d.id);a.data("saved",true)}else{if(d.status==="ERROR"){alert("Save failed: "+d.message)}else{alert("Save failed: "+e)}}},"json").fail(function(){alert("Save failed.")})}function saveTokenImage(a,d){a.data("file").name=d;var b="/ajax/recruiting_token_image/save/";var c={recruiting_token_id:a.data("token_id"),file_name:d};postSave(a,b,c)}function saveTokenVideo(a){var b="/ajax/recruiting_token_video/save/";var c={recruiting_token_id:a.data("token_id"),url:a.data("url"),source:a.data("source"),source_id:a.attr("id")};postSave(a,b,c)}function isValid(e){var a=false;var c=$("#"+e);var b=c[0].value;if(typeof b=="undefined"||!b){var d=c[0].label;$("#validation-message").html(d+" is a required field.");$("#validation-dialog")[0].open()}else{a=true}return a}function linkifyText(){$("#job-title")[0].updateValueAndPreserveCaret(Autolinker.link($("#job-title").val()));$("#job-description")[0].updateValueAndPreserveCaret(Autolinker.link($("#job-description").val()));$("#skills-required")[0].updateValueAndPreserveCaret(Autolinker.link($("#skills-required").val()));$("#responsibilities")[0].updateValueAndPreserveCaret(Autolinker.link($("#responsibilities").val()));$("#perks")[0].updateValueAndPreserveCaret(Autolinker.link($("#perks").val()));$("#company")[0].updateValueAndPreserveCaret(Autolinker.link($("#company").val()));$("#company-values")[0].updateValueAndPreserveCaret(Autolinker.link($("#company-values").val()))}function saveRecruitingToken(c){var d=null;var b=null;var a=null;if($("#recruiting-token-form")[0].validate()){linkifyText();setStatus("Saving token...");a=document.getElementById("recruiting-token-form").serialize();$.post("/ajax/recruiting_token/save/",a,function(f,h){if(f.status==="SUCCESS"){$("#id").val(f.id);$("#long-id").val(f.long_id);var e=f.user_id;var g=f.id;if(g&&e){$(".recruiting-token-image").each(function(){var i=$(this);i.data("token_id",g);if(!i.data("saved")){var j=i.data("file");var k=e+"_"+g+"_"+Date.now()+"_"+j.name;i.data("file_name",k);uploadFile(j,k,i)}});$(".recruiting-token-video").each(function(){var i=$(this);i.data("token_id",g);if(!i.data("saved")){saveTokenVideo(i)}});deleteChildren("image");deleteChildren("video")}closeStatus();if(c){window.open("/token/recruiting/"+f.long_id,"_blank")}}else{if(f.status==="ERROR"){alert(f.message)}else{alert(h)}}$("#save-button").html("Save")},"json").fail(function(){alert("Save failed")})}}function openToken(){var b=$("#token-to-open");var a=$("#token-to-open")[0].contentElement;a.selected=null;$("#open-dialog")[0].open()}function processOpen(){if($("#open-token-form")[0].validate()){setStatus("Opening token...");var b=$("#token-to-open")[0].contentElement;var a=b.selectedItem.id;$("#open-dialog")[0].close();window.location="/create_recruiting.php?id="+a}}function setStatus(a){$("#status-message").html(a);$("#status-dialog").css("height","170px");$("#status-dialog")[0].open()}function closeStatus(){$("#status-dialog").css("height","0px");$("#status-dialog")[0].close()}function shrink(a){a.animate({height:"toggle"},1000,function(){})}function fadeIn(a){a.animate({opacity:1},1000,function(){})}function finish(){shrink($("#company-social-media"));shrink($("#company-videos"));shrink($("#company-images"));shrink($("#company-info"));shrink($("#basic-info"));shrink($("#required-info"));$(".bottom-button").each(function(){shrink($(this))});fadeIn($("#send-token-via"))};