var companyInfo=null;var text="https://www.linkedin.com/company/";$(document).ready(function(){$("#linkedin-url").val(text).keydown(function(){$("label").css("color","");$("#linkedin-url").attr("label","Enter your company's LinkedIn URL");$("#linkedin-submit-button").text("Submit").attr("onclick","processLinkedIn()")});$("#linkedin-submit-button").text("Submit");$("#linkedin-progress").hide();$("#alert-dialog")[0].close();cleanUploads("refresh")});function initLinkedIn(){$("#linkedin-dialog")[0].open();$("#linkedin-submit-button").text("Submit").attr("onclick","processLinkedIn()")}function cleanUploads(a){$.ajax({type:"POST",dataType:"json",data:{clear:a},url:"/ajax/linkedin-scraper",error:function(d,b,c){console.error(c)}})}function processLinkedIn(){var b=$("#linkedin-url");var a=b.val();if(a.length===0){$("label").css("color","red");b.attr("label","Enter your company's LinkedIn URL")}else{$("#linkedin-progress").show();openLinkedIn(a)}}function openLinkedIn(a){$.ajax({type:"POST",dataType:"json",data:{link:a},url:"/ajax/linkedin-scraper",success:function(c){try{companyInfo=JSON.parse(c.data)}catch(b){console.error(b)}$("#linkedin-progress").hide();if(companyInfo===null||(companyInfo.name.length===0&&companyInfo.description.length===0&&companyInfo.legacyLogo.length===0&&companyInfo.heroImage.length===0)){$("label").css("color","red");$("#linkedin-url").attr("label","LinkedIn company not found")}else{$("label").css("color","green");$("#linkedin-url").attr("label","LinkedIn company and information found");$("#linkedin-submit-button").text("Select").attr("onclick","addData()")}},error:function(d,b,c){console.error(c)}})}function cancelLinkedIn(){$("label").css("color","");$("#linkedin-url").attr("label","Enter your company's LinkedIn URL");$("#linkedin-progress").hide();$("#linkedin-url").val(text);$("#linkedin-submit-button").text("Select").attr("onclick","processLinkedIn()");try{var a=companyInfo.key;cleanUploads(a)}catch(b){}}function resetLinkedIn(){$("#linkedin-dialog")[0].close();$("label").css("color","");$("#linkedin-url").attr("label","Enter your company's LinkedIn URL");$("#linkedin-progress").hide();$("#linkedin-url").val(text);$("#linkedin-submit-button").text("Select").attr("onclick","processLinkedIn()")}function addData(){var c=false;var a=["#company","#company-description","#company-linkedin"];for(var b=0;b<a.length;b++){if($(a[b]).val().length>0){c=true;break}}if($("#company-image-container").children().length!==0){c=true}if(c){$("#alert-dialog")[0].open();$("#alert-ok").click(function(){addDataConfirmed();$("#alert-dialog")[0].close()});$("#alert-cancel").click(function(){$("#alert-dialog")[0].close();resetLinkedIn()})}else{addDataConfirmed()}}function addDataConfirmed(){addName();addDescription();clearExistingImages();addImages();addURL();resetLinkedIn()}function addName(){$("#company").val(companyInfo.name)}function addDescription(){$("#company-description").val(companyInfo.description)}function clearExistingImages(){var e="#company-image-container";var b=".photo-thumbnail";var a=$(b);for(var d=0;d<a.length;d++){var f=$(a[d]).attr("id");var c=f.slice(-10);cleanUploads(c)}$(e).children().length>0?$(e).empty():null}function addImages(){var a=["heroImage","legacyLogo"];var b=null;for(var e=0;e<a.length;e++){var d=companyInfo.key;if(companyInfo[a[e]].length>0){var c="https://media.licdn.com/media"+companyInfo[a[e]];b=$('<img class="recruiting-token-image" id="'+a[e]+"-"+d+'">');$(b).attr("src",c);b.data("file",null);b.data("name",a[e]+"-"+d);b.data("saved",false);b.data("scraped",true);createThumbnail(b,"company-image-container")}}}function addURL(){var a=companyInfo.url;var b=a.replace("https://www.linkedin.com/","");$("#company-linkedin").val(b)}function uploadScrapedImage(c,b,a){$.ajax({type:"POST",dataType:"json",url:"ajax/linkedin-scraper",data:{oldName:b,newName:a},success:function(e,d){if(e.success){saveScrapedImage(c,a)}},error:function(f,d,e){console.error(e)}})}function saveScrapedImage(c,b){c.data("name",b);var a="ajax/recruiting_company_image/save";var d={recruiting_company_id:c.data("recruiting_company_id"),file_name:b};postSave(c,a,d)};